name: Build and Release on Windows

on:
  push:
    tags:
      - 'win-v*'

jobs:
 build-windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20' # Specify Node.js version

    - name: Install Frontend Dependencies
      run: |
        cd frontend/pocketllm
        npm install

    - name: Package the Frontend
      run: |
        cd frontend/pocketllm
        npm run build
      env:
        GH_TOKEN: ${{ secrets.GH_TOKEN }}

    - name: Debug - List files in dist directory
      run: Get-ChildItem ./frontend/pocketllm/dist -Force | Format-Table
      shell: pwsh

    - name: Prepare Artifacts for Upload
      run: |
        New-Item -ItemType Directory -Force -Path artifacts_for_upload
        Get-ChildItem frontend/pocketllm/dist -Filter '*.exe' | ForEach-Object { Copy-Item $_.FullName artifacts_for_upload }
        Get-ChildItem frontend/pocketllm/dist -Filter 'latest.yml' | ForEach-Object { Copy-Item $_.FullName artifacts_for_upload }
      shell: pwsh

    - name: Upload Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: Windows-app
        path: artifacts_for_upload/